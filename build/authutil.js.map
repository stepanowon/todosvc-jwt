{"version":3,"file":"authutil.js","names":["_jsonwebtoken","_interopRequireDefault","require","_crypto","obj","__esModule","secretKey","process","env","JWT_SECRET_KEY","createToken","exports","_ref","userid","role","console","log","token","jwt","sign","algorithm","expiresIn","checkToken","_ref2","callback","verify","algorithms","err","decode","status","message","exp","Date","now","users","computeHMAC","password","createHash","update","digest"],"sources":["../src/authutil.js"],"sourcesContent":["import jwt from 'jsonwebtoken'\r\nimport { createHash } from 'crypto'\r\n\r\nlet secretKey = \"mysecretkey\";\r\nif (process.env.JWT_SECRET_KEY) {\r\n    secretKey = process.env.JWT_SECRET_KEY;\r\n}\r\n\r\nconst createToken = ({ userid, role }) => {\r\n    console.log(userid + \", \"+role)\r\n    let token = jwt.sign({\r\n        userid, role\r\n    }, secretKey, {\r\n        algorithm : \"HS256\",\r\n        expiresIn:\"14d\",\r\n    })\r\n    return token;\r\n}\r\n\r\nconst checkToken = ({ token, callback }) => {\r\n    jwt.verify(token, secretKey, { algorithms: ['HS256'] }, (err, decode) => { \r\n        if (err) {\r\n            callback({status: \"fail\", message:err })\r\n        } else {\r\n            const exp = new Date(decode.exp * 1000)\r\n            const now = Date.now()\r\n            if (exp < now) {\r\n              callback({ status:\"fail\", message: \"expired token\" })\r\n            } else {\r\n              callback({ status:\"success\", users: decode})\r\n            }\r\n        }\r\n    })\r\n}\r\n\r\nconst computeHMAC = (userid, password) => {\r\n    return createHash('sha256').update(userid + \":\" +password).digest('hex');\r\n} \r\n\r\nexport { createToken, checkToken, computeHMAC };"],"mappings":";;;;;;AAAA,IAAAA,aAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,OAAA,GAAAD,OAAA;AAAmC,SAAAD,uBAAAG,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,gBAAAA,GAAA;AAEnC,IAAIE,SAAS,GAAG,aAAa;AAC7B,IAAIC,OAAO,CAACC,GAAG,CAACC,cAAc,EAAE;EAC5BH,SAAS,GAAGC,OAAO,CAACC,GAAG,CAACC,cAAc;AAC1C;AAEA,IAAMC,WAAW,GAAAC,OAAA,CAAAD,WAAA,GAAG,SAAdA,WAAWA,CAAAE,IAAA,EAAyB;EAAA,IAAnBC,MAAM,GAAAD,IAAA,CAANC,MAAM;IAAEC,IAAI,GAAAF,IAAA,CAAJE,IAAI;EAC/BC,OAAO,CAACC,GAAG,CAACH,MAAM,GAAG,IAAI,GAACC,IAAI,CAAC;EAC/B,IAAIG,KAAK,GAAGC,wBAAG,CAACC,IAAI,CAAC;IACjBN,MAAM,EAANA,MAAM;IAAEC,IAAI,EAAJA;EACZ,CAAC,EAAER,SAAS,EAAE;IACVc,SAAS,EAAG,OAAO;IACnBC,SAAS,EAAC;EACd,CAAC,CAAC;EACF,OAAOJ,KAAK;AAChB,CAAC;AAED,IAAMK,UAAU,GAAAX,OAAA,CAAAW,UAAA,GAAG,SAAbA,UAAUA,CAAAC,KAAA,EAA4B;EAAA,IAAtBN,KAAK,GAAAM,KAAA,CAALN,KAAK;IAAEO,QAAQ,GAAAD,KAAA,CAARC,QAAQ;EACjCN,wBAAG,CAACO,MAAM,CAACR,KAAK,EAAEX,SAAS,EAAE;IAAEoB,UAAU,EAAE,CAAC,OAAO;EAAE,CAAC,EAAE,UAACC,GAAG,EAAEC,MAAM,EAAK;IACrE,IAAID,GAAG,EAAE;MACLH,QAAQ,CAAC;QAACK,MAAM,EAAE,MAAM;QAAEC,OAAO,EAACH;MAAI,CAAC,CAAC;IAC5C,CAAC,MAAM;MACH,IAAMI,GAAG,GAAG,IAAIC,IAAI,CAACJ,MAAM,CAACG,GAAG,GAAG,IAAI,CAAC;MACvC,IAAME,GAAG,GAAGD,IAAI,CAACC,GAAG,CAAC,CAAC;MACtB,IAAIF,GAAG,GAAGE,GAAG,EAAE;QACbT,QAAQ,CAAC;UAAEK,MAAM,EAAC,MAAM;UAAEC,OAAO,EAAE;QAAgB,CAAC,CAAC;MACvD,CAAC,MAAM;QACLN,QAAQ,CAAC;UAAEK,MAAM,EAAC,SAAS;UAAEK,KAAK,EAAEN;QAAM,CAAC,CAAC;MAC9C;IACJ;EACJ,CAAC,CAAC;AACN,CAAC;AAED,IAAMO,WAAW,GAAAxB,OAAA,CAAAwB,WAAA,GAAG,SAAdA,WAAWA,CAAItB,MAAM,EAAEuB,QAAQ,EAAK;EACtC,OAAO,IAAAC,kBAAU,EAAC,QAAQ,CAAC,CAACC,MAAM,CAACzB,MAAM,GAAG,GAAG,GAAEuB,QAAQ,CAAC,CAACG,MAAM,CAAC,KAAK,CAAC;AAC5E,CAAC"}