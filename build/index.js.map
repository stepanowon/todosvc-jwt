{"version":3,"file":"index.js","names":["_express","_interopRequireDefault","require","_bodyParser","_cors","_morgan","_path","_fs","_routes","_authutil","obj","__esModule","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","o","minLen","_arrayLikeToArray","n","Object","prototype","toString","call","slice","constructor","name","Array","from","test","len","length","arr2","r","l","t","Symbol","iterator","e","u","a","f","next","done","push","value","isArray","app","express","use","cors","req","res","header","baseDir","path","resolve","rfs","logDirectory","join","fs","existsSync","mkdirSync","accessLogStream","createStream","size","interval","morgan","stream","set","process","env","PORT","console","log","engine","renderFile","bodyParser","json","urlencoded","extended","startsWith","auth_header","headers","authorization","_auth_header$split","split","_auth_header$split2","token","checkToken","callback","jwtresult","status","users","message","routes","server","listen","get"],"sources":["../src/index.js"],"sourcesContent":["import express from 'express';\r\nimport bodyParser from 'body-parser';\r\nimport cors from 'cors';\r\nimport morgan from 'morgan';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\nimport routes from './routes';\r\nimport { checkToken } from './authutil'\r\n\r\nconst app = express();\r\n\r\napp.use(cors());\r\n\r\napp.use(function (req, res, next) {\r\n    res.header('Cache-Control', 'private, no-cache, no-store, must-revalidate');\r\n    res.header('Expires', '-1');\r\n    res.header('Pragma', 'no-cache');\r\n    next()\r\n});\r\n\r\n//-- 로깅\r\nvar baseDir = path.resolve('.');\r\n\r\nconst rfs = require(\"rotating-file-stream\");\r\nconst logDirectory = path.join(baseDir, '/log')\r\nfs.existsSync(logDirectory) || fs.mkdirSync(logDirectory)\r\nconst accessLogStream = rfs.createStream(\"access.log\", {\r\n  size: \"10M\",\r\n  interval: \"1d\",\r\n  path: logDirectory\r\n});\r\n\r\napp.use(morgan('combined', {stream: accessLogStream}))\r\n\r\napp.set('port', (process.env.PORT || 3000));\r\n\r\napp.use(express.static(baseDir + '/public'));\r\nconsole.log(baseDir + '/views');\r\napp.set('views', baseDir + '/views');\r\napp.set('view engine', 'ejs');\r\napp.engine('html', require('ejs').renderFile);\r\napp.use(bodyParser.json());\r\napp.use(bodyParser.urlencoded({\r\n  extended: true\r\n}));\r\n\r\napp.use(function (req, res, next) {\r\n    res.header('Cache-Control', 'private, no-cache, no-store, must-revalidate');\r\n    res.header('Expires', '-1');\r\n    res.header('Pragma', 'no-cache');\r\n    next()\r\n});\r\n\r\n//권한 검증용 MW\r\napp.use((req, res, next) => {\r\n  if (!req.path.startsWith('/todolist') && !req.path.startsWith('/todolist_long')) {\r\n    next();\r\n    return;\r\n  } \r\n  //console.log(\"## JWT Middleware!! : \" + req.path)\r\n  let auth_header = req.headers.authorization;\r\n  if (auth_header) {\r\n      let [ name, token ] = auth_header.split(\" \")\r\n      if (typeof(name) === \"string\" && name === \"Bearer\") {\r\n        checkToken({ token, callback: (jwtresult) => {\r\n          if (jwtresult.status === \"success\") {\r\n            req.users = jwtresult.users;\r\n            next()\r\n          } else {\r\n            res.json(jwtresult);\r\n          }\r\n        }})\r\n      } else {\r\n        res.json({ status:\"fail\", message:\"토큰의 형식이 올바르지 않습니다. Bearer Token 형식을 사용합니다.\" })\r\n      }\r\n  } else {\r\n      res.json({ status:\"fail\", message:\"authorization 요청 헤더를 통해 토큰이 전달되지 않았습니다.\" })\r\n  }\r\n\r\n});\r\n\r\nroutes(app);\r\n\r\nconst server = app.listen(app.get('port'), function() {\r\n    console.log(\"할일 목록 서비스가 \" + app.get('port') + \"번 포트에서 시작되었습니다!\");\r\n});"],"mappings":";;AAAA,IAAAA,QAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,WAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,KAAA,GAAAH,sBAAA,CAAAC,OAAA;AACA,IAAAG,OAAA,GAAAJ,sBAAA,CAAAC,OAAA;AACA,IAAAI,KAAA,GAAAL,sBAAA,CAAAC,OAAA;AACA,IAAAK,GAAA,GAAAN,sBAAA,CAAAC,OAAA;AACA,IAAAM,OAAA,GAAAP,sBAAA,CAAAC,OAAA;AACA,IAAAO,SAAA,GAAAP,OAAA;AAAuC,SAAAD,uBAAAS,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,gBAAAA,GAAA;AAAA,SAAAE,eAAAC,GAAA,EAAAC,CAAA,WAAAC,eAAA,CAAAF,GAAA,KAAAG,qBAAA,CAAAH,GAAA,EAAAC,CAAA,KAAAG,2BAAA,CAAAJ,GAAA,EAAAC,CAAA,KAAAI,gBAAA;AAAA,SAAAA,iBAAA,cAAAC,SAAA;AAAA,SAAAF,4BAAAG,CAAA,EAAAC,MAAA,SAAAD,CAAA,qBAAAA,CAAA,sBAAAE,iBAAA,CAAAF,CAAA,EAAAC,MAAA,OAAAE,CAAA,GAAAC,MAAA,CAAAC,SAAA,CAAAC,QAAA,CAAAC,IAAA,CAAAP,CAAA,EAAAQ,KAAA,aAAAL,CAAA,iBAAAH,CAAA,CAAAS,WAAA,EAAAN,CAAA,GAAAH,CAAA,CAAAS,WAAA,CAAAC,IAAA,MAAAP,CAAA,cAAAA,CAAA,mBAAAQ,KAAA,CAAAC,IAAA,CAAAZ,CAAA,OAAAG,CAAA,+DAAAU,IAAA,CAAAV,CAAA,UAAAD,iBAAA,CAAAF,CAAA,EAAAC,MAAA;AAAA,SAAAC,kBAAAT,GAAA,EAAAqB,GAAA,QAAAA,GAAA,YAAAA,GAAA,GAAArB,GAAA,CAAAsB,MAAA,EAAAD,GAAA,GAAArB,GAAA,CAAAsB,MAAA,WAAArB,CAAA,MAAAsB,IAAA,OAAAL,KAAA,CAAAG,GAAA,GAAApB,CAAA,GAAAoB,GAAA,EAAApB,CAAA,IAAAsB,IAAA,CAAAtB,CAAA,IAAAD,GAAA,CAAAC,CAAA,UAAAsB,IAAA;AAAA,SAAApB,sBAAAqB,CAAA,EAAAC,CAAA,QAAAC,CAAA,WAAAF,CAAA,gCAAAG,MAAA,IAAAH,CAAA,CAAAG,MAAA,CAAAC,QAAA,KAAAJ,CAAA,4BAAAE,CAAA,QAAAG,CAAA,EAAAnB,CAAA,EAAAT,CAAA,EAAA6B,CAAA,EAAAC,CAAA,OAAAC,CAAA,OAAAzB,CAAA,iBAAAN,CAAA,IAAAyB,CAAA,GAAAA,CAAA,CAAAZ,IAAA,CAAAU,CAAA,GAAAS,IAAA,QAAAR,CAAA,QAAAd,MAAA,CAAAe,CAAA,MAAAA,CAAA,UAAAM,CAAA,uBAAAA,CAAA,IAAAH,CAAA,GAAA5B,CAAA,CAAAa,IAAA,CAAAY,CAAA,GAAAQ,IAAA,MAAAH,CAAA,CAAAI,IAAA,CAAAN,CAAA,CAAAO,KAAA,GAAAL,CAAA,CAAAT,MAAA,KAAAG,CAAA,GAAAO,CAAA,iBAAAR,CAAA,IAAAjB,CAAA,OAAAG,CAAA,GAAAc,CAAA,yBAAAQ,CAAA,YAAAN,CAAA,eAAAI,CAAA,GAAAJ,CAAA,cAAAf,MAAA,CAAAmB,CAAA,MAAAA,CAAA,2BAAAvB,CAAA,QAAAG,CAAA,aAAAqB,CAAA;AAAA,SAAA7B,gBAAAF,GAAA,QAAAkB,KAAA,CAAAmB,OAAA,CAAArC,GAAA,UAAAA,GAAA;AAEvC,IAAMsC,GAAG,GAAG,IAAAC,mBAAO,EAAC,CAAC;AAErBD,GAAG,CAACE,GAAG,CAAC,IAAAC,gBAAI,EAAC,CAAC,CAAC;AAEfH,GAAG,CAACE,GAAG,CAAC,UAAUE,GAAG,EAAEC,GAAG,EAAEV,IAAI,EAAE;EAC9BU,GAAG,CAACC,MAAM,CAAC,eAAe,EAAE,8CAA8C,CAAC;EAC3ED,GAAG,CAACC,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC;EAC3BD,GAAG,CAACC,MAAM,CAAC,QAAQ,EAAE,UAAU,CAAC;EAChCX,IAAI,CAAC,CAAC;AACV,CAAC,CAAC;;AAEF;AACA,IAAIY,OAAO,GAAGC,gBAAI,CAACC,OAAO,CAAC,GAAG,CAAC;AAE/B,IAAMC,GAAG,GAAG3D,OAAO,CAAC,sBAAsB,CAAC;AAC3C,IAAM4D,YAAY,GAAGH,gBAAI,CAACI,IAAI,CAACL,OAAO,EAAE,MAAM,CAAC;AAC/CM,cAAE,CAACC,UAAU,CAACH,YAAY,CAAC,IAAIE,cAAE,CAACE,SAAS,CAACJ,YAAY,CAAC;AACzD,IAAMK,eAAe,GAAGN,GAAG,CAACO,YAAY,CAAC,YAAY,EAAE;EACrDC,IAAI,EAAE,KAAK;EACXC,QAAQ,EAAE,IAAI;EACdX,IAAI,EAAEG;AACR,CAAC,CAAC;AAEFX,GAAG,CAACE,GAAG,CAAC,IAAAkB,kBAAM,EAAC,UAAU,EAAE;EAACC,MAAM,EAAEL;AAAe,CAAC,CAAC,CAAC;AAEtDhB,GAAG,CAACsB,GAAG,CAAC,MAAM,EAAGC,OAAO,CAACC,GAAG,CAACC,IAAI,IAAI,IAAK,CAAC;AAE3CzB,GAAG,CAACE,GAAG,CAACD,mBAAO,UAAO,CAACM,OAAO,GAAG,SAAS,CAAC,CAAC;AAC5CmB,OAAO,CAACC,GAAG,CAACpB,OAAO,GAAG,QAAQ,CAAC;AAC/BP,GAAG,CAACsB,GAAG,CAAC,OAAO,EAAEf,OAAO,GAAG,QAAQ,CAAC;AACpCP,GAAG,CAACsB,GAAG,CAAC,aAAa,EAAE,KAAK,CAAC;AAC7BtB,GAAG,CAAC4B,MAAM,CAAC,MAAM,EAAE7E,OAAO,CAAC,KAAK,CAAC,CAAC8E,UAAU,CAAC;AAC7C7B,GAAG,CAACE,GAAG,CAAC4B,sBAAU,CAACC,IAAI,CAAC,CAAC,CAAC;AAC1B/B,GAAG,CAACE,GAAG,CAAC4B,sBAAU,CAACE,UAAU,CAAC;EAC5BC,QAAQ,EAAE;AACZ,CAAC,CAAC,CAAC;AAEHjC,GAAG,CAACE,GAAG,CAAC,UAAUE,GAAG,EAAEC,GAAG,EAAEV,IAAI,EAAE;EAC9BU,GAAG,CAACC,MAAM,CAAC,eAAe,EAAE,8CAA8C,CAAC;EAC3ED,GAAG,CAACC,MAAM,CAAC,SAAS,EAAE,IAAI,CAAC;EAC3BD,GAAG,CAACC,MAAM,CAAC,QAAQ,EAAE,UAAU,CAAC;EAChCX,IAAI,CAAC,CAAC;AACV,CAAC,CAAC;;AAEF;AACAK,GAAG,CAACE,GAAG,CAAC,UAACE,GAAG,EAAEC,GAAG,EAAEV,IAAI,EAAK;EAC1B,IAAI,CAACS,GAAG,CAACI,IAAI,CAAC0B,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC9B,GAAG,CAACI,IAAI,CAAC0B,UAAU,CAAC,gBAAgB,CAAC,EAAE;IAC/EvC,IAAI,CAAC,CAAC;IACN;EACF;EACA;EACA,IAAIwC,WAAW,GAAG/B,GAAG,CAACgC,OAAO,CAACC,aAAa;EAC3C,IAAIF,WAAW,EAAE;IACb,IAAAG,kBAAA,GAAsBH,WAAW,CAACI,KAAK,CAAC,GAAG,CAAC;MAAAC,mBAAA,GAAA/E,cAAA,CAAA6E,kBAAA;MAAtC3D,IAAI,GAAA6D,mBAAA;MAAEC,KAAK,GAAAD,mBAAA;IACjB,IAAI,OAAO7D,IAAK,KAAK,QAAQ,IAAIA,IAAI,KAAK,QAAQ,EAAE;MAClD,IAAA+D,oBAAU,EAAC;QAAED,KAAK,EAALA,KAAK;QAAEE,QAAQ,EAAE,SAAAA,SAACC,SAAS,EAAK;UAC3C,IAAIA,SAAS,CAACC,MAAM,KAAK,SAAS,EAAE;YAClCzC,GAAG,CAAC0C,KAAK,GAAGF,SAAS,CAACE,KAAK;YAC3BnD,IAAI,CAAC,CAAC;UACR,CAAC,MAAM;YACLU,GAAG,CAAC0B,IAAI,CAACa,SAAS,CAAC;UACrB;QACF;MAAC,CAAC,CAAC;IACL,CAAC,MAAM;MACLvC,GAAG,CAAC0B,IAAI,CAAC;QAAEc,MAAM,EAAC,MAAM;QAAEE,OAAO,EAAC;MAA6C,CAAC,CAAC;IACnF;EACJ,CAAC,MAAM;IACH1C,GAAG,CAAC0B,IAAI,CAAC;MAAEc,MAAM,EAAC,MAAM;MAAEE,OAAO,EAAC;IAA0C,CAAC,CAAC;EAClF;AAEF,CAAC,CAAC;AAEF,IAAAC,kBAAM,EAAChD,GAAG,CAAC;AAEX,IAAMiD,MAAM,GAAGjD,GAAG,CAACkD,MAAM,CAAClD,GAAG,CAACmD,GAAG,CAAC,MAAM,CAAC,EAAE,YAAW;EAClDzB,OAAO,CAACC,GAAG,CAAC,aAAa,GAAG3B,GAAG,CAACmD,GAAG,CAAC,MAAM,CAAC,GAAG,iBAAiB,CAAC;AACpE,CAAC,CAAC"}